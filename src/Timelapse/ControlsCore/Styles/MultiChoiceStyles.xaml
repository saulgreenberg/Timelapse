<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:toolkit="http://timelapsewpf.toolkit/xaml">

    <!-- Merged common resources that multichoice styles depend on -->
    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="CommonResources.xaml"/>
    </ResourceDictionary.MergedDictionaries>

    <!--#region MultiLineEditor Style -->
    <toolkit:InverseBoolConverter x:Key="InverseBoolConverter" />
    <!--#endregion -->

    <!--#region WatermarkCheckComboBox Style -->
    <Geometry x:Key="DownArrowGeometry">M 0,1 C0,1 0,0 0,0 0,0 3,0 3,0 3,0 3,1 3,1 3,1 4,1 4,1 4,1 4,0 4,0 4,0 7,0 7,0 7,0 7,1 7,1 7,1 6,1 6,1 6,1 6,2 6,2 6,2 5,2 5,2 5,2 5,3 5,3 5,3 4,3 4,3 4,3 4,4 4,4 4,4 3,4 3,4 3,4 3,3 3,3 3,3 2,3 2,3 2,3 2,2 2,2 2,2 1,2 1,2 1,2 1,1 1,1 1,1 0,1 0,1 z</Geometry>
    <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />

    <!-- ReSharper disable once Xaml.RedundantResource -->
    <SolidColorBrush x:Key="ButtonNormalBorder" Color="#FF707070" />

    <!-- DefaultWatermarkTemplate is now defined in CommonResources.xaml -->

    <Style x:Key="ComboBoxToggleButton" TargetType="{x:Type ToggleButton}">
        <Setter Property="OverridesDefaultStyle" Value="true" />
        <Setter Property="IsTabStop" Value="false" />
        <Setter Property="Focusable" Value="false" />
        <Setter Property="Padding" Value="2" />
        <Setter Property="BorderThickness" Value="{StaticResource BorderThicknessCommonNormal}"/>
        <Setter Property="BorderBrush" Value="{StaticResource BorderBrushCommonNormal}"/>
        <Setter Property="Height" Value="28" />
        <Setter Property="Background"  Value="Red"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ToggleButton}">
                    <toolkit:ButtonChrome x:Name="Chrome"
                           BorderBrush="{TemplateBinding BorderBrush}"
                           Background="{TemplateBinding Background}"
                           CornerRadius="0"
                           RenderEnabled="{TemplateBinding IsEnabled}"
                           RenderMouseOver="{Binding IsMouseOver, ElementName=PART_DropDownButton}"
                           RenderNormal="False"
                           RenderPressed="{Binding IsPressed, ElementName=PART_DropDownButton}"
                           SnapsToDevicePixels="true">

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition MinWidth="{DynamicResource {x:Static SystemParameters.VerticalScrollBarWidthKey}}" Width="0" />
                            </Grid.ColumnDefinitions>

                            <TextBox x:Name="TextBox"
                                         Text="{Binding Content, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}"
                               Foreground="{TemplateBinding Foreground}"
                               IsReadOnly="True"
                               Focusable="False"
                               Cursor="Arrow"
                               IsTabStop="{TemplateBinding IsTabStop}"
                               BorderThickness="0"
                               Background="White"
                               Margin="{TemplateBinding Padding}"
                               HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                               SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                               VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                               HorizontalScrollBarVisibility="Hidden"
                               VerticalScrollBarVisibility="Hidden" />
                            <Grid Grid.Column="1"
                                  HorizontalAlignment="Right"
                                  Width="{DynamicResource {x:Static SystemParameters.VerticalScrollBarWidthKey}}">
                                <Path x:Name="Arrow"
                                      Data="{StaticResource DownArrowGeometry}"
                                      Fill="Black"
                                      HorizontalAlignment="Center"
                                      Margin="3,0,3,0"
                                      VerticalAlignment="Center" />
                            </Grid>
                        </Grid>

                    </toolkit:ButtonChrome>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsChecked" Value="true">
                            <Setter Property="RenderPressed" TargetName="Chrome" Value="true" />
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="false">
                            <Setter Property="Fill" TargetName="Arrow" Value="#AFAFAF" />
                        </Trigger>
                        <DataTrigger Binding="{Binding IsEditable, RelativeSource={RelativeSource AncestorType={x:Type toolkit:WatermarkCheckComboBox}}}" Value="True">
                            <Setter Property="IsReadOnly" Value="False" TargetName="TextBox" />
                            <Setter Property="Focusable" Value="True" TargetName="TextBox" />
                            <Setter Property="Cursor" Value="{x:Null}" TargetName="TextBox" />
                            <Setter Property="IsTabStop" Value="True" />
                        </DataTrigger>
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding IsEditable, RelativeSource={RelativeSource AncestorType={x:Type toolkit:WatermarkCheckComboBox}}}" Value="True" />
                                <Condition Binding="{Binding IsFocused, RelativeSource={RelativeSource AncestorType={x:Type toolkit:WatermarkCheckComboBox}}}" Value="True" />
                            </MultiDataTrigger.Conditions>
                            <Setter TargetName="TextBox" Property="FocusManager.FocusedElement" Value="{Binding ElementName=TextBox}" />
                        </MultiDataTrigger>
                        <DataTrigger Binding="{Binding ForceWatermark, RelativeSource={RelativeSource AncestorType={x:Type toolkit:WatermarkCheckComboBox}}}" Value="True">
                            <Setter Property="Visibility" TargetName="TextBox" Value="Hidden" />
                        </DataTrigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style x:Key="MultiChoiceComboBox" TargetType="{x:Type toolkit:WatermarkCheckComboBox}">
        <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}" />
        <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.WindowBrushKey}}" />
        <Setter Property="BorderThickness" Value="{StaticResource BorderThicknessCommonNormal}"/>
        <Setter Property="BorderBrush" Value="{StaticResource BorderBrushCommonNormal}"/>
        <Setter Property="Height" Value="25" />
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Auto" />
        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto" />
        <Setter Property="Padding" Value="1,2,1,2" />
        <Setter Property="ScrollViewer.CanContentScroll" Value="true" />
        <Setter Property="ScrollViewer.PanningMode" Value="Both" />
        <Setter Property="Stylus.IsFlicksEnabled" Value="False" />
        <Setter Property="VerticalContentAlignment" Value="Top" />
        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
        <Setter Property="WatermarkTemplate" Value="{StaticResource DefaultWatermarkTemplate}" />
        <!--<Setter Property="ShowAllTextWhenAllSelected" Value="False"/>-->
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type toolkit:WatermarkCheckComboBox}">
                    <Border Name="PART_Border" BorderBrush="{StaticResource BorderBrushCommonNormal}" BorderThickness="{StaticResource BorderThicknessCommonNormal}">

                        <Grid x:Name="MainGrid" SnapsToDevicePixels="true">
                            <Popup x:Name="PART_Popup"
                           AllowsTransparency="true"
                           IsOpen="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                           StaysOpen="False"
                           Margin="1"
                           PopupAnimation="{DynamicResource {x:Static SystemParameters.ComboBoxPopupAnimationKey}}"
                           Placement="Bottom">
                                <Grid MinWidth="{Binding ActualWidth, ElementName=MainGrid}">
                                    <Border x:Name="DropDownBorder"
                                    MaxHeight="{Binding MaxDropDownHeight,  RelativeSource={RelativeSource TemplatedParent}}"
                                    BorderBrush="{DynamicResource {x:Static SystemColors.WindowFrameBrushKey}}"
                                    BorderThickness="1"
                                    Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}">
                                        <ScrollViewer x:Name="DropDownScrollViewer">
                                            <Grid RenderOptions.ClearTypeHint="Enabled">
                                                <Canvas HorizontalAlignment="Left"
                                                  Height="0"
                                                  VerticalAlignment="Top"
                                                  Width="0">
                                                    <Rectangle x:Name="OpaqueRect"
                                                   Fill="{Binding Background, ElementName=DropDownBorder}"
                                                   Height="{Binding ActualHeight, ElementName=DropDownBorder}"
                                                   Width="{Binding ActualWidth, ElementName=DropDownBorder}" />
                                                </Canvas>
                                                <StackPanel>
                                                    <toolkit:SelectAllSelectorItem x:Name="PART_SelectAllSelectorItem"
                                                Content="{TemplateBinding SelectAllContent}"
                                                Visibility="{Binding IsSelectAllActive, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BoolToVisibilityConverter}}" />
                                                    <ItemsPresenter x:Name="PART_ItemsPresenter"
                                                    KeyboardNavigation.DirectionalNavigation="Contained"
                                                    SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                                </StackPanel>
                                            </Grid>
                                        </ScrollViewer>
                                    </Border>
                                </Grid>
                            </Popup>

                            <ToggleButton x:Name="PART_DropDownButton"
                              Content="{Binding Text, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}"
                              BorderBrush="{TemplateBinding BorderBrush}"
                              Background="{TemplateBinding Background}"
                              Focusable="False"
                              IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                              Style="{StaticResource ComboBoxToggleButton}"
                              Padding="{TemplateBinding Padding}"
                              VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                              HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                              IsHitTestVisible="{Binding IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource InverseBoolConverter}}" />
                            <ContentPresenter x:Name="PART_WatermarkHost"
                                              Content="{TemplateBinding Watermark}"
                                              ContentTemplate="{TemplateBinding WatermarkTemplate}"
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              IsHitTestVisible="False"
                                              Margin="{TemplateBinding Padding}"
                                              Visibility="Collapsed" />
                        </Grid>
                    </Border>
                    <ControlTemplate.Triggers>
                        <!--When we tab to the control, accentuate the outline. -->
                        <Trigger Property="ComboBox.IsFocused" Value="True">
                            <Setter TargetName="PART_Border" Property="BorderThickness" Value="{StaticResource BorderThicknessCommonHighlight}" />
                            <Setter TargetName="PART_Border" Property="BorderBrush" Value="{StaticResource BorderBrushCommonHighlight}" />
                        </Trigger>

                        <Trigger Property="ComboBox.IsKeyboardFocusWithin" Value="True">
                            <Setter TargetName="PART_Border" Property="BorderThickness" Value="{StaticResource BorderThicknessCommonHighlight}" />
                            <Setter TargetName="PART_Border" Property="BorderBrush" Value="{StaticResource BorderBrushCommonHighlight}" />
                        </Trigger>

                        <Trigger Property="toolkit:WatermarkCheckComboBox.IsDropDownOpen" Value="True">
                            <Setter TargetName="PART_Border" Property="BorderThickness" Value="{StaticResource BorderThicknessCommonHighlight}" />
                            <Setter TargetName="PART_Border" Property="BorderBrush" Value="{StaticResource BorderBrushCommonHighlight}" />
                        </Trigger>

                        <!-- Watermark triggers -->
                        <Trigger Property="IsEditable" Value="True">
                            <Setter Property="IsTabStop" Value="False" />
                        </Trigger>
                        <Trigger Property="Text" Value="{x:Null}">
                            <Setter Property="Visibility" TargetName="PART_WatermarkHost" Value="Visible" />
                        </Trigger>
                        <Trigger Property="ForceWatermark" Value="True">
                            <Setter Property="Visibility" TargetName="PART_WatermarkHost" Value="Visible" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <Style.Triggers>
            <Trigger Property="IsEditable" Value="True">
                <Setter Property="IsTabStop" Value="False" />
            </Trigger>
        </Style.Triggers>
    </Style>

    <Style TargetType="{x:Type toolkit:WatermarkCheckComboBox}" BasedOn="{StaticResource MultiChoiceComboBox}" />
    <!--#endregion-->

</ResourceDictionary>
