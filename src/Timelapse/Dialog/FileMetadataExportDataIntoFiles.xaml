<controls:BusyableDialogWindow  x:Class="Timelapse.Dialog.FileMetadataExportDataIntoFiles"
                                xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                                xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                                xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                                xmlns:controls="clr-namespace:Timelapse.Controls"
                                xmlns:toolkit="http://timelapsewpf.toolkit/xaml"
                                mc:Ignorable="d"
                                Title="Export data into files as XMP metadata" Height="900" Width="740" Loaded="FileMetadataExportDataIntoFiles_OnLoaded">
    <Grid>
        <Grid Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header/Instructions -->
            <toolkit:FormattedMessageContent x:Name="WriteExifDataMessage"  Grid.Row="0"
                            Icon="{x:Static toolkit:DialogIconType.Question}"
                            DialogTitle="Export (embed) data into files as file metadata"
                            What="Timelapse can export each image or video's data directly into each of your currently selected files as metadata.
                                  [br]That data is embedded into the actual file, and can be read by other programs (including Timelapse)."

                            Solution=" [ni]Select the data fields you want to export.
                                       [ni]Optionally check [e]Include metadata that collects...[/e] to also export all selected fields as a Json structure,
                                       [ni]Click the appropriate button to begin exporting to only the current file, or to all currently selected files."

                            Hint="[li]See [e]Details[/e] section below for an instructional summary.
                                  [li]Read the [e]File Metadata[/e] chapter in the [link:{x:Static constant:ExternalLinks.TimelapseGuideReference}|Timelapse Reference Guide]."

                            Result="Each file will incorporate that data in a metadata group called [e]XMP-TimelapseData[/e] metadata. When done, feedback will be presented."

                            Details="Timelapse writes metadata into the file as follows.
                                [li]Each data field selected is written as a separate metadata entry in the [e]XMP-TimelapseData[/e] directory:
                                  [li 2]name = the data label (e.g., species)
                                  [li 2]value = the particular value held in the data field for the image (e.g., deer)
                                [li]If [e]Include metadata that collects...[/e] is checked, an additional field is written, where:
                                  [li 2]name = [e]json[/e]
                                  [li 2]value = a Json structure containing all selected data label/value pairs, e.g., [e]{&quot;species&quot;:&quot;deer&quot;,&quot;count&quot;:1}[/e]
                                  [li 2]The Json format is useful if you plan to use that data elsewhere: it is easy to parse, handles special characters in data labels and values, and distinguishes numbers from strings.
                                 [br 12][b]Limitations[/b]: Metadata cannot be written to [e]AVI[/e] files"
                            ShowExplanationVisibility="True" />

            <!-- Checkbox List Area (ScrollViewer for long lists) -->
            <GroupBox Name="AvailableDataLabelsPanel"
                  Grid.Row="1"
                  VerticalAlignment="Stretch"
                  Padding="5">
                <GroupBox.Header>
                    <TextBlock Text="Select the data to export as metadata fields" FontWeight="Bold"/>
                </GroupBox.Header>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Export options at top -->
                    <StackPanel Grid.Row="0"
                               Orientation="Horizontal"
                               Margin="5,0,5,5"
                               VerticalAlignment="Center">
                        <CheckBox x:Name="IncludeJsonMetadataCheckBox"
                                 VerticalAlignment="Center"
                                 IsChecked="True">
                            <TextBlock Text="Include metadata that collects all selected data labels and values in a json structure" FontWeight="SemiBold"/>
                        </CheckBox>
                    </StackPanel>

                    <!-- Checkbox list -->
                    <ScrollViewer Grid.Row="1"
                                 VerticalScrollBarVisibility="Auto">
                        <StackPanel x:Name="CheckBoxPanel"
                                   Orientation="Vertical"
                                   Margin="5"/>
                    </ScrollViewer>
                </Grid>
            </GroupBox>

            <!-- Progress Output Area -->
            <GroupBox Name="ProgressPanel" Visibility ="Collapsed"
                  Grid.Row="1"
                  VerticalAlignment="Stretch"
                  Padding="5"
                  Margin="0,10,0,0">
                <GroupBox.Header>
                    <TextBlock Text="Results" FontWeight="Bold"/>
                </GroupBox.Header>
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <DockPanel>
                        <TextBox x:Name="ProgressTextBox"
                                 DockPanel.Dock="Top"
                                 IsReadOnly="True"
                                 TextWrapping="Wrap"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 MaxHeight="200"/>
                        <StackPanel DockPanel.Dock="Bottom" Orientation="Vertical">
                            <TextBlock x:Name="MetadataGridHeader"
                                       Text="This XMP-TimelapseData is now present in the currently viewed file."
                                       FontWeight="SemiBold"
                                       Margin="10,10,10,5"
                                       Visibility="Collapsed"/>
                            <controls:FileMetadataGrid x:Name="MetadataGrid"
                                                       VerticalAlignment="Stretch"
                                                       Visibility="Collapsed"/>
                        </StackPanel>
                    </DockPanel>
                </ScrollViewer>
            </GroupBox>

            <!-- Button Panel -->
            <StackPanel Grid.Row="2"
                   Orientation="Horizontal"
                   HorizontalAlignment="Right"
                   Margin="0,10,0,0">
                <TextBlock Name="TextBlockExportLabel"
                    Text="Export data as metadata into:"
                          FontWeight="DemiBold"
                          VerticalAlignment="Center"
                          Margin="0,0,10,0"/>
                <Button x:Name="WriteMetadataButton"
                   Content="the current file only"
                   Width="Auto"
                   Height="40"
                   Margin="0,0,10,0"
                   Padding="10,5"
                   Click="WriteMetadataButton_Click"
                   IsEnabled="False"/>
                <Button x:Name="WriteMetadataToAllButton"
                   Content="all currently selected files"
                   Width="Auto"
                   Height="40"
                   Margin="0,0,10,0"
                   Padding="10,5"
                   Click="WriteMetadataToAll_Click"
                   IsEnabled="False"/>
                <Button x:Name="CloseButton"
                   Content="_Cancel"
                   Width="Auto"
                   Height="40"
                   Padding="10,5"
                   IsCancel="True"
                   Click="CloseButton_Click"/>
            </StackPanel>
        </Grid>
        <controls:BusyCancelIndicator x:Name="BusyCancelIndicator" IsBusy="False" Grid.Row="0" CancelClick="CancelAsyncOperationButton_Click"/>
    </Grid>
</controls:BusyableDialogWindow>
