<controls:BusyableDialogWindow x:Class="Timelapse.Dialog.MergeCheckinDatabaseFiles"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
       xmlns:controls="clr-namespace:Timelapse.Controls"
        xmlns:toolkit="clr-namespace:TimelapseWpf.Toolkit;assembly=TimelapseWpf.Toolkit"
        mc:Ignorable="d"
        Title="Check in Databases..." Height="700" Width="680" MinHeight="700" MinWidth="680" Loaded="Window_Loaded" Closing="Window_Closing">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <toolkit:FormattedMessageContent x:Name="Message" Grid.Row="0" Icon="{x:Static toolkit:DialogIconType.Question}"
                            DialogTitle="Check in (merge) a database into the master database"
                            What="Check in (merge) data into the master database by selecting one or more
                                database [i].ddb[/i] files that were found in its sub-folders. Timelapse will:
                                  [ni] Merge data from the selected databases into the currently opened master database file,
                                  [ni] Warn you about databases that cannot be merged."   
                            Result="Timelapse [e]completely replaces[/e] the portion of the master database matching the selected  database's sub-folder with that child database's data. Recognition data (if any) is included.
                                          [br]See [e]Details[/e] to help you understand how this works."
                            Hint="[li] All databases must be based on the same template, otherwise the merge will fail.
                                  [li] Databases must be located in the sub-folder matching the desired relative path in the master database, as otherwise the merged data will be incorrect.
                                  [li]Consider reading: [e]Merging Databases[/e] in the [link:{x:Static constant:ExternalLinks.TimelapseGuideReference}|Timelapse Reference Guide]."
                            Details ="Merging will result in the following, where the examples are to files located in the child's sub-folder.
                                          [li] If the master and child database both include data to the same file, the child's data will replace the master's data for that file.
                                          [li] If the master includes data to a file that is not present in the child database, that file will no longer appear in the master.
                                          [li] If the child includes data to a file that is not present in the master database, that file and its data will appear in the master.
                                          [li] If your master/child database includes duplicates, they are just treated as data associated with the file. The same rules above apply.
                                          [li] Folder metadata in the master database for child database's folders will always be replaced by the child database's folder metadata. 
                                          This means that if the child database does not have metadata for that folder and the master does, then the master's metadata will be deleted.
                                          "/>
        <Rectangle Fill="#FF868686" Height="1" Grid.Row="1" />
        <StackPanel Orientation="Horizontal" Grid.Row="2" Margin="5,0,0,0">
            <TextBlock Name="ResultsBanner" FontWeight="Bold" FontSize="14" Text="Choose one or more databases and click 'Check in...'" Margin="5,5,10,0"/>
            <Button Name="ButtonSelectAll" Content="Select all databases" Margin="10,0,10,0" Click="ButtonSelectAll_Click" />
            <Button Name="ButtonSelectNone" Content="Unselect the databases" Margin="0,0,10,0" Click="ButtonSelectNone_Click"/>
        </StackPanel>
        <ListBox Name="ListboxFileDatabases" Grid.Row="3"  ScrollViewer.VerticalScrollBarVisibility="Auto" Margin="10,0,10,5" 
                 ItemsSource="{Binding ObservableDdbFileList}" >
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <CheckBox IsChecked="{Binding IsSelected}" 
                              Content="{Binding ShortPathDisplayName}" 
                              ToolTip="{Binding RelativePathIncludingFileName }" 
                              Checked="Selector_CheckChanged" Unchecked="Selector_CheckChanged">
                        <d:CheckBox.DataContext>
                            <d:DesignInstance />
                        </d:CheckBox.DataContext>
                    </CheckBox>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <FlowDocumentScrollViewer Name="FinalMessageScrollViewer" Visibility="Collapsed"  Grid.Row="3" Margin="10,0,10,5" HorizontalAlignment="Stretch" VerticalScrollBarVisibility="Auto">
            <FlowDocument Name="FlowDocument"/>
        </FlowDocumentScrollViewer>

        <Separator Grid.Row="4" BorderBrush="Gainsboro" BorderThickness="10"/>
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Grid.Row="5">
           
            <Button Name="CancelButton" IsCancel="True" VerticalAlignment="Bottom" HorizontalAlignment="Stretch" Padding="10" Margin="10,10,10,10" Click="CancelButton_Click">_Cancel</Button>
            <Button Name="CheckInButton" IsDefault="True" VerticalAlignment="Bottom" HorizontalAlignment="Stretch" Padding="10" Margin="10,10,10,10" Click="CheckInButton_Click">_Check in database(s)</Button>
            <Button Name="DoneButton" IsDefault="True"  VerticalAlignment="Bottom" HorizontalAlignment="Stretch" Visibility ="Collapsed" Padding="10" Margin="10,10,10,10" Click="DoneButton_Click">_Done</Button>
        </StackPanel>

        <!-- Busy Indicator: when true, it shows the progress bar, text message, plus a cancel button -->
        <controls:BusyCancelIndicator x:Name="BusyCancelIndicator" IsBusy="False" CancelClick="CancelAsyncOperationButton_Click" Grid.Row="0"/>
    </Grid>
</controls:BusyableDialogWindow>

